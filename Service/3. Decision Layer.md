# 📡 Module 03: Decision Layer & AI Logic
> **Project:** 6G-Guardian (ISAC-based Contactless Athlete Protection System)  
> **Module:** AI Inference, Digital Twin, Decision Logic  
> **Version:** 1.1.0 (Updated Multi-Physics Model)  
> **Author:** Mobile Engineering Dept. KNU

---

## 1. 서론 (Introduction)

### 1.1. 개요 (Overview)
**Decision Layer**는 Infrastructure Layer로부터 수신된 Semantic Feature(의미 정보)를 기반으로 실시간 추론(Inference)을 수행하는 최상위 논리 계층이다.
본 모듈은 **ST-GCN(동작)**, **Transformer(떨림)**, **PINN(체온/수분)** 등 **4가지 전문화된 뉴럴 네트워크의 앙상블(Ensemble)** 구조를 통해 선수의 외적 움직임과 내적 생체 상태를 동시에 분석한다. 또한 **Personalized Digital Twin(개인화 디지털 트윈)** 기술을 접목하여 선수 개개인의 고유한 신체 특성을 반영한 정밀 위험도 산출을 수행한다.

---

## 2. AI 모델 아키텍처 (AI Model Architecture)

본 시스템은 다중 모달(Multi-modal) 데이터를 처리하기 위해 다음과 같은 4가지 핵심 모델로 구성된다.



### 2.1. Skeletal Analysis Model: ST-GCN
관절의 움직임(Kinematics)을 분석하여 구조적 부상 위험을 감지한다.
* **Algorithm:** **Spatio-Temporal Graph Convolutional Network (ST-GCN)**.
* **Input:** $N$개의 관절(Node)과 뼈(Edge)로 구성된 시계열 그래프 데이터 ($T \times V \times C$).
    * $T$: Time Frames (Window size: 30~60 frames).
    * $V$: Vertices (19 Keypoints).
    * $C$: Channels (x, y, z Coordinates + Confidence).
* **Operation:**
    * **Spatial Graph Conv:** 프레임 내에서 인접한 관절 간의 상관관계 분석 (예: 무릎과 발목의 앵글).
    * **Temporal Conv:** 시간 축을 따라 동작의 흐름과 가속도 변화 분석.
* **Output:** Action Class (Running, Falling, Abnormal) & Joint Stress Vector.

### 2.2. Tremor Detection Model: Hybrid CNN-Transformer
마이크로 도플러 스펙트로그램(이미지)에서 미세 떨림 패턴을 찾아낸다.
* **Algorithm:** **CNN Backbone (ResNet-18) + Transformer Encoder**.
* **Input:** Micro-Doppler Spectrogram (Time-Frequency Image).
* **Mechanism:**
    1.  **CNN:** 이미지에서 로컬 특징(Local Features, 떨림의 주파수 대역) 추출.
    2.  **Transformer (Self-Attention):** 시계열적 문맥(Context)을 파악하여 일시적인 노이즈인지, 지속적인 **병리학적 떨림(Pathological Tremor)**인지 구분.
    * **Attention Mechanism:** $\text{Attention}(Q, K, V) = \text{softmax}(\frac{QK^T}{\sqrt{d_k}})V$.
* **Target:** 8~12Hz 대역의 비정상 진동 패턴 감지.

### 2.3. Digital Twin Comparator (Baseline Comparison)
* **Concept:** 모든 선수에게 동일한 기준을 적용하지 않고, 선수 개인별 **'정상 상태 모델(Baseline Model)'**을 구축.
* **Technology:** **Few-shot Learning / Online Learning**.
* **Process:**
    * 경기 전 웜업 데이터를 통해 해당 선수의 평소 가동 범위(RoM), 보행 대칭성, 심박 패턴을 학습.
    * 실시간 데이터와 Baseline 간의 **KL-Divergence (Kullback-Leibler Divergence)**를 계산하여 이상치(Anomaly) 정도를 정량화.

### 2.4. Thermal & Hydration Inference Model: Multi-stage MLP Mixer
THz 라디오메트리 신호(수동)와 반사 계수 데이터(능동)를 결합하여, 직접 측정이 불가능한 심부 온도와 탈수 지수를 추론하는 다중 물리(Multi-physics) 모델이다.
* **Algorithm:** **Physics-Informed Neural Networks (PINN)** 및 **MLP-Mixer**.
* **Input Features:**
    * **Passive Signal:** $0.1 \sim 1.5 \text{ THz}$ 대역의 방사 전압($V_{out}$, Radiometric Voltage).
    * **Active Signal:** THz 반사 계수($\Gamma$) 및 위상 변이($\Delta \phi$).
    * **Context Data:** 경기장 기온, 습도, 선수의 기초 대사량($Q_m$).
* **Operation Logic:**
    1.  **Bio-heat Solver Layer (PINN):**
        * Pennes 생체 열 방정식(Bio-heat Equation)을 신경망의 **손실 함수(Loss Function)**에 물리적 제약 조건으로 포함시킨다.
        * 순수 데이터 기반 학습의 오류를 방지하고, 측정된 피부 온도($T_s$)와 6G로 감지한 혈류량($\omega_b$) 데이터로부터 내부의 **심부 온도($T_b$)**를 정밀하게 역산출(Inverse Calculation)한다.
    2.  **Sweat Duct Analyzer:**
        * 땀샘의 나선형 구조(Helical Structure)에 의한 안테나 공명 주파수($f_r$) 이동을 추적한다.
        * MLP-Mixer가 주파수 이동 패턴을 분석하여 현재의 **발한량(Sweating Rate)**과 체내 수분 손실률을 수치화한다.
* **Output:** Core Body Temperature ($^\circ\text{C}$), Hydration Level (%).

---

## 3. 의사결정 로직 및 알고리즘 (Decision Logic & Algorithm)

AI 모델의 출력값을 종합하여 최종적으로 "경기 중단" 여부를 판단하는 수학적 알고리즘이다.

### 3.1. 통합 위험도 점수 산출 (Total Risk Scoring)
최종 위험 점수 $R_{total}$은 운동학적 위험과 생체 내부 위험의 가중 합으로 계산된다.

$$R_{total}(t) = w_1 \cdot R_{kin}(t) + w_2 \cdot R_{trem}(t) + w_3 \cdot R_{vit}(t)$$

* **$R_{kin}$ (운동학적 위험도):**
    * ST-GCN 출력값. 관절의 굴곡/신전 각도가 해부학적 임계치($\theta_{th}$)를 초과하는 정도를 시그모이드 함수로 정규화한다.
* **$R_{trem}$ (떨림 위험도):**
    * CNN-Transformer 출력값. 근육 피로 누적에 따른 8~12Hz 대역의 생리학적 떨림 진폭을 반영한다.
* **$R_{vit}$ (바이탈 위험도):**
    * 심박/호흡 변동성과 함께 심부 체온 및 탈수 지수를 결합한 복합 지표이다.
    $$R_{vit}(t) = \beta_1 \cdot R_{temp}(t) + \beta_2 \cdot R_{hyd}(t) + \beta_3 \cdot R_{cardio}(t)$$
    * **$R_{temp}$:** PINN 모델로 역산된 심부 온도 $T_b$가 위험 임계치($39.5^\circ\text{C}$)에 근접하는 지수.
    * **$R_{hyd}$:** THz 반사 계수($\Gamma$) 변화를 통해 산출된 체내 수분 손실률이 2%를 초과하는 정도.
    * **$R_{cardio}$:** 심박수 급증 및 심박 변이도(HRV) 감소량.

### 3.2. 판단 흐름도 (Decision Flowchart)

1.  **Level 1: Pre-Warning (주의)**
    * Condition: $50 \le R_{total} < 75$.
    * Action: 코칭 스태프 태블릿에 **"Yellow Alert"** 전송. (예: "Player #7 햄스트링 피로도 누적 중")
2.  **Level 2: Critical Warning (경고)**
    * Condition: $75 \le R_{total} < 90$.
    * Action: 의료진에게 **"Red Alert"** 전송 및 해당 부위(왼쪽 무릎 등) 하이라이트.
3.  **Level 3: Game Stop (경기 중단)**
    * Condition: $R_{total} \ge 90$ OR **Detect Acute Event** (e.g., ACL Tear Signal).
    * Action: 심판의 웨어러블 기기에 진동 및 **"STOP"** 신호 즉시 전송. 자동화된 드론/카메라가 해당 선수 포커싱.

---

## 4. 성능 최적화 및 엣지 컴퓨팅 (Performance Optimization)

0.1ms급 초저지연 의사결정을 위한 소프트웨어 최적화 기술이다.

### 4.1. Model Quantization (모델 경량화)
* **Technique:** FP32(32-bit Floating Point) 모델을 **INT8(8-bit Integer)**로 양자화.
* **Tool:** NVIDIA TensorRT.
* **Effect:** 추론 속도 4배 향상, 메모리 사용량 1/4 감소, 정확도 손실 1% 미만.

### 4.2. Pipelining & Parallelism
* **Approach:** 센싱 데이터 수신(I/O), 전처리(CPU), 모델 추론(GPU)을 병렬 파이프라인으로 처리.
* **Throughput:** 초당 1000 프레임(FPS) 이상 처리 가능하여 다수 선수의 동시 추적 보장.

---

## 5. 데이터셋 및 학습 전략 (Dataset & Training Strategy)

### 5.1. Training Data
본 모델 학습을 위해 다음과 같은 오픈 데이터셋과 자체 구축 데이터를 활용한다.
* **NTU RGB+D 120:** 대규모 3D 행동 인식 데이터셋 (ST-GCN 학습용).
* **RadHAR (Radar Human Activity Recognition):** 레이더 기반 행동 인식 데이터셋.
* **Simulated Data:** Unity/Unreal Engine 기반의 물리 엔진 시뮬레이션으로 희귀 부상 케이스(골절, 실신 등) 데이터 생성.
* **Passive THz Emission Dataset:** 인체 방사율($\epsilon$) 및 주파수별 방사 특성 데이터. 실온($23.5^\circ\text{C}$) 대비 인체($32.2^\circ\text{C}$) 신호의 NETD($4.4\text{K}$) 실측값 활용.
* **Hydration-Reflection Mapping:** 피부 수분 함량에 따른 THz 복소 유전율 변화 시뮬레이션 데이터.

### 5.2. Federated Learning (연합 학습) - *Optional*
* **Concept:** 각 구단의 민감한 선수 데이터는 로컬 서버에서만 학습하고, 모델의 가중치(Weight)만 중앙 서버로 공유.
* **Privacy:** 선수의 개인 의료 정보 보호 규정(GDPR/HIPAA) 준수.

---

## 6. 결론 (Conclusion)

Decision Layer는 단순한 규칙 기반(Rule-based) 시스템을 넘어, **Multi-Physics Deep Learning**과 **Digital Twin** 기술을 결합하여 상황 맥락(Context)을 이해하는 지능형 시스템이다.
특히 **ST-GCN**을 통한 구조적 분석, **Transformer**를 통한 미세 떨림 감지, 그리고 **PINN**을 통한 내과적 상태 추론의 결합은 인간 심판이 인지할 수 없는 0.1초 찰나의 부상 징후를 정확히 포착하여 스포츠 안전의 새로운 표준을 제시한다.

---

## 7. 참고 문헌 (References)

1.  **"Spatial Temporal Graph Convolutional Networks for Skeleton-Based Action Recognition"** (S. Yan et al., AAAI 2018)
    * *Core Algorithm:* ST-GCN 아키텍처 원전.
2.  **"Attention Is All You Need"** (Vaswani et al., NIPS 2017)
    * *Core Algorithm:* Transformer 및 Self-Attention 메커니즘.
3.  **"Deep Learning for Sensor-based Activity Recognition: A Survey"** (L. Wang et al.)
    * *Context:* 센서 데이터(Time-series) 처리 딥러닝 기법.
4.  **"Digital Twin: Values, Challenges and Enablers"** (IEEE Access)
    * *Concept:* 디지털 트윈의 개념 및 헬스케어 적용 사례.
5.  **"Passive Detection and Imaging of Human Body Radiation Using an Uncooled Field-Effect Transistor-Based THz Detector"** (D. Čibiraitė-Lukenskienė et al., Sensors 2020)
    * *Core Tech:* 상온 TeraFET을 이용한 인체 방사 에너지 감지 및 NETD 실증.
6.  **"Morphological study of sweat ducts for the investigation of terahertz waves interaction with human skin"** (Nature Scientific Reports)
    * *Core Tech:* 땀샘의 나선형 안테나 모델 및 THz 수분 감지 원리.

---
*Created by [Your Name] for 6G-Guardian Project.*
